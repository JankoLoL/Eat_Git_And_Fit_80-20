{% extends '__base__.html' %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
    <div class="container mt-4">
        <h1 class="mb-4">Add Recipe</h1>
        <form method="post" id="recipe-form" class="needs-validation" novalidate>
            {% csrf_token %}
            {{ formset.management_form }}


            <div class="row">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        {{ form.name.label_tag }}
                        {{ form.name|add_class:"form-control" }}
                    </div>
                    <div class="form-group mb-3">
                        {{ form.description.label_tag }}
                        {{ form.description|add_class:"form-control" }}
                    </div>
                    <div class="form-group mb-3">
                        {{ form.instructions.label_tag }}
                        {{ form.instructions|add_class:"form-control" }}
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group mb-3">
                        {{ form.category.label_tag }}
                        {{ form.category|add_class:"form-control" }}
                    </div>
                    <div class="form-group mb-3">
                        {{ form.occasion.label_tag }}
                        {{ form.occasion|add_class:"form-control" }}
                    </div>
                    <div class="form-group mb-3">
                        {{ form.cuisine.label_tag }}
                        {{ form.cuisine|add_class:"form-control" }}
                    </div>
                </div>
            </div>

            <!-- Display formset errors -->
            {% if formset.non_form_errors %}
                <div class="alert alert-danger">
                    <strong>General Formset Errors:</strong>
                    {{ formset.non_form_errors }}
                </div>
            {% endif %}

            <!-- Ingredients Formset -->
            <div id="form-set" class="mt-3">
                {% for form in formset %}
                    <div class="ingredient-form row mb-3">
                        <!-- Display errors for each form in the formset -->
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {{ form.non_field_errors.as_text }}
                            </div>
                        {% endif %}
                        <div class="col-md-4">
                            {{ form.ingredients.label_tag }}
                            {{ form.ingredients|add_class:"form-control" }}
                            {% if form.ingredients.errors %}
                                <div class="alert alert-danger">
                                    {{ form.ingredients.errors.as_text }}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            {{ form.quantity.label_tag }}
                            {{ form.quantity|add_class:"form-control" }}
                            {% if form.quantity.errors %}
                                <div class="alert alert-danger">
                                    {{ form.quantity.errors.as_text }}
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            {{ form.measure.label_tag }}
                            {{ form.measure|add_class:"form-control" }}
                            {% if form.measure.errors %}
                                <div class="alert alert-danger">
                                    {{ form.measure.errors.as_text }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>

            <div class="row mt-4">
                <div class="col-md-12">
                    <button type="button" id="add-more" class="btn btn-primary me-2">Add More Ingredients</button>
                    <input type="submit" value="Submit" class="btn btn-success">
                </div>
            </div>
        </form>
    </div>
{% endblock content %}

{% block javascript %}
    <script src="{% static 'js/add_ingredient.js' %}"></script>
{% endblock javascript %}
